import{u as le,r as l,a as O,j as e,H as ie}from"./app-C3PKLGoL.js";import{H as oe}from"./heading-B4dCvnhu.js";import{A as de,X as me,C as R,a as xe,s as he}from"./app-layout-D2SrO8rl.js";import{c as T,B as n}from"./app-logo-icon-D-cOAJme.js";import{C as m,a as f,b as N,c as B,d as x}from"./card-Cj48m257.js";import{I as pe}from"./input-B5iEnYPt.js";import{L as ue}from"./label-Ch8UcfqI.js";import{S as ge,a as je,b as fe,c as Ne,d as ye}from"./select-CLRzEkVU.js";import{S as ve}from"./separator-Bvwio8AR.js";import{P as be}from"./plus-COPmsNhR.js";import{S as U}from"./shopping-cart-edQ9ovCH.js";import{U as W}from"./user-BTMXJANy.js";import{S as Ce}from"./search-BP4-7uKA.js";import{C as X}from"./circle-check-big-CP1zUJhd.js";/* empty css            */import"./index-CvNSqVN9.js";import"./index-B3f_JMYd.js";import"./index-ODGsgQVY.js";import"./check-FuHEO5wI.js";const we=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],Se=T("Maximize",we);const ke=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],Me=T("Minimize",ke);const Pe=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],G=T("Save",Pe),Fe=[{title:"Point of Sale",href:"/pos"}];function Je({products:J,members:p}){const{flash:C}=le().props,[w,K]=l.useState(""),[S,Y]=l.useState(J),[y,M]=l.useState([]),[v,P]=l.useState(null),[Z,F]=l.useState(!1),k=l.useRef(null),t=y.find(s=>s.id===v)||null,i=t?.member_id||"",u=t?.payment_method||"cash",o=t?.items||[],Q=t?.notes||"",h=O({cart:[],member_id:"",total:0,payment_method:"cash"}),g=O({cart:[],member_id:"",total:0,notes:""}),L=l.useMemo(()=>w?S.filter(s=>s.name.toLowerCase().includes(w.toLowerCase())):S,[S,w]),_=async()=>{try{const s=await fetch("/pos/products",{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});if(s.ok){const a=await s.json();Y(a.products||[])}}catch(s){console.error("Failed to refresh products:",s)}},b=l.useMemo(()=>o.reduce((s,a)=>s+a.subtotal,0),[o]),A=l.useMemo(()=>{if(!i)return!1;const s=p.find(a=>a.id.toString()===i);return s?s.balance<2e3:!1},[i,p]),I=(s="")=>{const a={id:`cart-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,member_id:s,items:[],payment_method:"cash",notes:"",status:"active"};M(r=>[...r,a]),P(a.id)},ee=s=>{P(s)},q=s=>{if(M(a=>a.filter(r=>r.id!==s)),v===s){const a=y.filter(r=>r.id!==s);P(a.length>0?a[0].id:null)}},d=s=>{v&&M(a=>a.map(r=>r.id===v?{...r,...s}:r))};l.useEffect(()=>{y.length===0&&I()},[]),l.useEffect(()=>{t&&h.setData({cart:t.items.map(s=>({id:s.product.id,quantity:s.quantity})),member_id:t.member_id,total:b,payment_method:t.payment_method})},[t,b]);const se=s=>{if(!t){alert("Please create a cart first by selecting a member");return}const a=t.items.find(r=>r.product.id===s.id);if(a){if(a.quantity>=s.current_stock){alert(`Only ${s.current_stock} items available in stock`);return}z(s.id,a.quantity+1)}else{if(s.current_stock<1){alert("Product is out of stock");return}const r={id:Date.now(),product:s,quantity:1,subtotal:s.selling_price};d({items:[...t.items,r]})}},z=(s,a)=>{if(!t)return;if(a<=0){H(s);return}const r=S.find(c=>c.id===s);if(r&&a>r.current_stock){alert(`Only ${r.current_stock} items available in stock`);return}const E=t.items.map(c=>c.product.id===s?{...c,quantity:a,subtotal:c.product.selling_price*a}:c);d({items:E})},H=s=>{if(!t)return;const a=t.items.filter(r=>r.product.id!==s);d({items:a})},te=()=>{t&&d({items:[],member_id:"",payment_method:"cash",notes:""})},$=()=>{if(!t||t.items.length===0){alert("Please add items to cart");return}g.setData({cart:t.items,member_id:t.member_id||"",total:b,payment_method:t.payment_method,notes:t.notes}),g.post("/pos/save-pending",{onSuccess:()=>{q(t.id),_()}})},V=()=>{if(!t||t.items.length===0){alert("Please add items to cart");return}if(t.payment_method==="pay_later"&&!t.member_id){alert("Please select a member for pay later option");return}d({status:"processing"}),h.setData({cart:t.items.map(s=>({id:s.product.id,quantity:s.quantity})),member_id:t.member_id,total:b,payment_method:t.payment_method}),h.post(he(),{onSuccess:()=>{q(t.id),_()},onError:()=>{d({status:"active"})}})},ae=s=>{d({member_id:s})},D=s=>{d({payment_method:s})},re=s=>{d({notes:s})},j=s=>`${(typeof s=="string"?parseFloat(s):s).toFixed(2)} VT`,ne=()=>{document.fullscreenElement?document.exitFullscreen().then(()=>{F(!1)}).catch(s=>{console.error("Error attempting to exit fullscreen:",s)}):k.current&&k.current.requestFullscreen().then(()=>{F(!0)}).catch(s=>{console.error("Error attempting to enable fullscreen:",s)})};return l.useEffect(()=>{const s=()=>{F(document.fullscreenElement===k.current)};return document.addEventListener("fullscreenchange",s),()=>document.removeEventListener("fullscreenchange",s)},[]),e.jsxs(de,{breadcrumbs:Fe,children:[e.jsx(ie,{title:"Point of Sale"}),e.jsxs("div",{ref:k,className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(oe,{title:"Point of Sale",description:"Process sales and manage transactions"}),e.jsx(n,{onClick:ne,variant:"outline",size:"sm",className:"flex items-center gap-2",children:Z?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"h-4 w-4"}),"Exit Fullscreen"]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"h-4 w-4"}),"Fullscreen"]})})]}),e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Active Carts"}),e.jsx(B,{children:"Manage multiple customer transactions"})]}),e.jsxs(n,{onClick:()=>I(),variant:"outline",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"New Cart"]})]})}),e.jsx(x,{children:y.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(U,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No active carts. Create a new cart to start."})]}):e.jsx("div",{className:"flex flex-wrap gap-2",children:y.map(s=>{const a=p.find(c=>c.id.toString()===s.member_id),r=s.items.reduce((c,ce)=>c+ce.subtotal,0),E=s.id===v;return e.jsxs("div",{className:`relative p-3 rounded-lg border-2 cursor-pointer transition-all ${E?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>ee(s.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:a?a.name:"Walk-in"})]}),e.jsx(n,{size:"sm",variant:"ghost",onClick:c=>{c.stopPropagation(),q(s.id)},className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",children:e.jsx(me,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.items.length," items • ",j(r)]}),s.status==="processing"&&e.jsx("div",{className:"text-xs text-orange-600 mt-1",children:"Processing..."})]},s.id)})})})]}),t&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx(m,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(pe,{placeholder:"Search products...",value:w,onChange:s=>K(s.target.value),className:"pl-10"})]})})}),e.jsxs(m,{children:[e.jsxs(f,{children:[e.jsxs(N,{children:["Products (",L.length,")"]}),e.jsx(B,{children:"Click on products to add to cart"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:L.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>se(s),children:[e.jsx("h3",{className:"font-medium text-sm mb-1",children:s.name}),e.jsx("p",{className:"text-lg font-bold text-green-600 mb-2",children:j(s.selling_price)}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Stock: ",s.current_stock]})]},s.id))}),L.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No products found"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Cart (",o.length,")"]})}),e.jsx(x,{className:"space-y-4",children:o.length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Cart is empty"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:o.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.product.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[j(s.product.selling_price)," each"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",onClick:()=>z(s.product.id,s.quantity-1),children:"-"}),e.jsx("span",{className:"w-8 text-center",children:s.quantity}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>z(s.product.id,s.quantity+1),children:"+"}),e.jsx(n,{size:"sm",variant:"destructive",onClick:()=>H(s.product.id),children:"×"})]})]},s.id))}),e.jsx(ve,{}),e.jsxs("div",{className:"flex justify-between items-center font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-lg text-green-600",children:j(b)})]}),e.jsx(n,{variant:"outline",onClick:te,className:"w-full",children:"Clear Cart"})]})})]}),e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Member"]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ue,{htmlFor:"member",children:"Select Member (Optional)"}),e.jsxs(ge,{value:i,onValueChange:ae,children:[e.jsx(je,{children:e.jsx(fe,{placeholder:"Walk-in customer"})}),e.jsx(Ne,{children:p.map(s=>{const r=(typeof s.balance=="string"?parseFloat(s.balance):s.balance)>=2e3;return e.jsx(ye,{value:s.id.toString(),className:r?"text-red-600 bg-red-50":"",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.name}),e.jsxs("span",{className:`text-xs ${r?"text-red-600 font-semibold":"text-gray-500"}`,children:[j(s.balance)," unpaid"]})]})},s.id)})})]})]}),i&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"Selected Member:"}),e.jsx("p",{className:"text-sm",children:p.find(s=>s.id.toString()===i)?.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Current balance: ",j(p.find(s=>s.id.toString()===i)?.balance||0)]})]})]})]}),e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Payment Method"]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(n,{variant:u==="cash"?"default":"outline",onClick:()=>D("cash"),className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Cash"]}),e.jsxs(n,{variant:u==="pay_later"?"default":"outline",onClick:()=>D("pay_later"),disabled:!i||!A,className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Pay Later"]})]}),u==="pay_later"&&i&&!A&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:'Member cannot use "Pay Later" option'}),e.jsx("p",{className:"text-xs text-red-600",children:"Unpaid amount is 2000 VT or more"})]}),u==="pay_later"&&!i&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-600 font-medium",children:'Select a member to use "Pay Later"'})})]})]}),e.jsxs(m,{children:[e.jsx(f,{children:e.jsx(N,{className:"text-sm",children:"Transaction Notes (Optional)"})}),e.jsx(x,{children:e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Add notes for this transaction...",value:Q,onChange:s=>re(s.target.value),rows:2})})]}),e.jsx(m,{children:e.jsxs(x,{className:"pt-6 space-y-3",children:[u==="pay_later"?e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs(n,{onClick:$,disabled:o.length===0||g.processing,size:"lg",className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),g.processing?"Saving...":"Save for Later"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Items will be handed over, payment collected later"})]}):u==="cash"?e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs(n,{onClick:V,disabled:o.length===0||h.processing,size:"lg",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),h.processing?"Processing...":"Complete Sale"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Process payment and complete transaction"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(n,{onClick:$,disabled:o.length===0||g.processing,variant:"outline",size:"lg",className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),g.processing?"Saving...":"Save"]}),e.jsxs(n,{onClick:V,disabled:o.length===0||h.processing,size:"lg",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),h.processing?"Processing...":"Complete"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs text-gray-500",children:[e.jsx("p",{className:"text-center",children:"Save for later processing"}),e.jsx("p",{className:"text-center",children:"Complete sale now"})]})]}),C?.success&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-600",children:C.success})}),C?.error&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:C.error})})]})})]})]})]})]})}export{Je as default};
