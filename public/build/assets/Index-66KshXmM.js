import{u as ae,r as d,a as E,j as e,H as re}from"./app-DkZ-DWhw.js";import{H as ce}from"./heading-cxkzRspZ.js";import{A as ne,X as ie,C as O,a as le,s as oe}from"./app-layout-DqFw64O5.js";import{c as k,B as n}from"./app-logo-icon-Bcxu4ubl.js";import{C as m,a as f,b as y,c as V,d as x}from"./card-DhDP5xCu.js";import{I as de}from"./input-o1SBJHVm.js";import{L as me}from"./label-C5RrW0iC.js";import{S as xe,a as he,b as pe,c as ue,d as je}from"./select-DREH3ghL.js";import{S as ge}from"./separator-DYkbTXrZ.js";import{S as fe}from"./search-CVq_ekZj.js";import{C as B}from"./circle-check-big-S6ndoAOs.js";/* empty css            */import"./index-k_kPhzW4.js";import"./index-CoeNSFUt.js";import"./index-BDqSilVs.js";import"./index-DC6JmAiA.js";import"./check-BlhVxzHt.js";const ye=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ne=k("Plus",ye);const ve=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],R=k("Save",ve);const be=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],U=k("ShoppingCart",be);const Ce=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],W=k("User",Ce),Se=[{title:"Point of Sale",href:"/pos"}];function Ve({products:X,members:p}){const{flash:C}=ae().props,[S,G]=d.useState(""),[w,J]=d.useState(X),[N,P]=d.useState([]),[v,M]=d.useState(null),t=N.find(s=>s.id===v)||null,i=t?.member_id||"",u=t?.payment_method||"cash",l=t?.items||[],K=t?.notes||"",h=E({cart:[],member_id:"",total:0,payment_method:"cash"}),j=E({cart:[],member_id:"",total:0,notes:""}),_=d.useMemo(()=>S?w.filter(s=>s.name.toLowerCase().includes(S.toLowerCase())):w,[w,S]),A=async()=>{try{const s=await fetch("/pos/products",{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});if(s.ok){const a=await s.json();J(a.products||[])}}catch(s){console.error("Failed to refresh products:",s)}},b=d.useMemo(()=>l.reduce((s,a)=>s+a.subtotal,0),[l]),F=d.useMemo(()=>{if(!i)return!1;const s=p.find(a=>a.id.toString()===i);return s?s.balance<2e3:!1},[i,p]),z=(s="")=>{const a={id:`cart-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,member_id:s,items:[],payment_method:"cash",notes:"",status:"active"};P(r=>[...r,a]),M(a.id)},Y=s=>{M(s)},L=s=>{if(P(a=>a.filter(r=>r.id!==s)),v===s){const a=N.filter(r=>r.id!==s);M(a.length>0?a[0].id:null)}},o=s=>{v&&P(a=>a.map(r=>r.id===v?{...r,...s}:r))};d.useEffect(()=>{N.length===0&&z()},[]),d.useEffect(()=>{t&&h.setData({cart:t.items.map(s=>({id:s.product.id,quantity:s.quantity})),member_id:t.member_id,total:b,payment_method:t.payment_method})},[t,b]);const Z=s=>{if(!t){alert("Please create a cart first by selecting a member");return}const a=t.items.find(r=>r.product.id===s.id);if(a){if(a.quantity>=s.current_stock){alert(`Only ${s.current_stock} items available in stock`);return}q(s.id,a.quantity+1)}else{if(s.current_stock<1){alert("Product is out of stock");return}const r={id:Date.now(),product:s,quantity:1,subtotal:s.selling_price};o({items:[...t.items,r]})}},q=(s,a)=>{if(!t)return;if(a<=0){H(s);return}const r=w.find(c=>c.id===s);if(r&&a>r.current_stock){alert(`Only ${r.current_stock} items available in stock`);return}const T=t.items.map(c=>c.product.id===s?{...c,quantity:a,subtotal:c.product.selling_price*a}:c);o({items:T})},H=s=>{if(!t)return;const a=t.items.filter(r=>r.product.id!==s);o({items:a})},Q=()=>{t&&o({items:[],member_id:"",payment_method:"cash",notes:""})},I=()=>{if(!t||t.items.length===0){alert("Please add items to cart");return}j.setData({cart:t.items,member_id:t.member_id||"",total:b,payment_method:t.payment_method,notes:t.notes}),j.post("/pos/save-pending",{onSuccess:()=>{L(t.id),A()}})},$=()=>{if(!t||t.items.length===0){alert("Please add items to cart");return}if(t.payment_method==="pay_later"&&!t.member_id){alert("Please select a member for pay later option");return}o({status:"processing"}),h.setData({cart:t.items.map(s=>({id:s.product.id,quantity:s.quantity})),member_id:t.member_id,total:b,payment_method:t.payment_method}),h.post(oe(),{onSuccess:()=>{L(t.id),A()},onError:()=>{o({status:"active"})}})},ee=s=>{o({member_id:s})},D=s=>{o({payment_method:s})},se=s=>{o({notes:s})},g=s=>`${(typeof s=="string"?parseFloat(s):s).toFixed(2)} VT`;return e.jsxs(ne,{breadcrumbs:Se,children:[e.jsx(re,{title:"Point of Sale"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(ce,{title:"Point of Sale",description:"Process sales and manage transactions"})}),e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(y,{children:"Active Carts"}),e.jsx(V,{children:"Manage multiple customer transactions"})]}),e.jsxs(n,{onClick:()=>z(),variant:"outline",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"New Cart"]})]})}),e.jsx(x,{children:N.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(U,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No active carts. Create a new cart to start."})]}):e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(s=>{const a=p.find(c=>c.id.toString()===s.member_id),r=s.items.reduce((c,te)=>c+te.subtotal,0),T=s.id===v;return e.jsxs("div",{className:`relative p-3 rounded-lg border-2 cursor-pointer transition-all ${T?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>Y(s.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:a?a.name:"Walk-in"})]}),e.jsx(n,{size:"sm",variant:"ghost",onClick:c=>{c.stopPropagation(),L(s.id)},className:"h-6 w-6 p-0 text-red-500 hover:text-red-700",children:e.jsx(ie,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.items.length," items • ",g(r)]}),s.status==="processing"&&e.jsx("div",{className:"text-xs text-orange-600 mt-1",children:"Processing..."})]},s.id)})})})]}),t&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx(m,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(de,{placeholder:"Search products...",value:S,onChange:s=>G(s.target.value),className:"pl-10"})]})})}),e.jsxs(m,{children:[e.jsxs(f,{children:[e.jsxs(y,{children:["Products (",_.length,")"]}),e.jsx(V,{children:"Click on products to add to cart"})]}),e.jsxs(x,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:_.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>Z(s),children:[e.jsx("h3",{className:"font-medium text-sm mb-1",children:s.name}),e.jsx("p",{className:"text-lg font-bold text-green-600 mb-2",children:g(s.selling_price)}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Stock: ",s.current_stock]})]},s.id))}),_.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No products found"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Cart (",l.length,")"]})}),e.jsx(x,{className:"space-y-4",children:l.length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Cart is empty"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:l.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.product.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[g(s.product.selling_price)," each"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",onClick:()=>q(s.product.id,s.quantity-1),children:"-"}),e.jsx("span",{className:"w-8 text-center",children:s.quantity}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>q(s.product.id,s.quantity+1),children:"+"}),e.jsx(n,{size:"sm",variant:"destructive",onClick:()=>H(s.product.id),children:"×"})]})]},s.id))}),e.jsx(ge,{}),e.jsxs("div",{className:"flex justify-between items-center font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-lg text-green-600",children:g(b)})]}),e.jsx(n,{variant:"outline",onClick:Q,className:"w-full",children:"Clear Cart"})]})})]}),e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Member"]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(me,{htmlFor:"member",children:"Select Member (Optional)"}),e.jsxs(xe,{value:i,onValueChange:ee,children:[e.jsx(he,{children:e.jsx(pe,{placeholder:"Walk-in customer"})}),e.jsx(ue,{children:p.map(s=>{const r=(typeof s.balance=="string"?parseFloat(s.balance):s.balance)>=2e3;return e.jsx(je,{value:s.id.toString(),className:r?"text-red-600 bg-red-50":"",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.name}),e.jsxs("span",{className:`text-xs ${r?"text-red-600 font-semibold":"text-gray-500"}`,children:[g(s.balance)," unpaid"]})]})},s.id)})})]})]}),i&&e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium",children:"Selected Member:"}),e.jsx("p",{className:"text-sm",children:p.find(s=>s.id.toString()===i)?.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Current balance: ",g(p.find(s=>s.id.toString()===i)?.balance||0)]})]})]})]}),e.jsxs(m,{children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Payment Method"]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(n,{variant:u==="cash"?"default":"outline",onClick:()=>D("cash"),className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Cash"]}),e.jsxs(n,{variant:u==="pay_later"?"default":"outline",onClick:()=>D("pay_later"),disabled:!i||!F,className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Pay Later"]})]}),u==="pay_later"&&i&&!F&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-600 font-medium",children:'Member cannot use "Pay Later" option'}),e.jsx("p",{className:"text-xs text-red-600",children:"Unpaid amount is 2000 VT or more"})]}),u==="pay_later"&&!i&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-600 font-medium",children:'Select a member to use "Pay Later"'})})]})]}),e.jsxs(m,{children:[e.jsx(f,{children:e.jsx(y,{className:"text-sm",children:"Transaction Notes (Optional)"})}),e.jsx(x,{children:e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Add notes for this transaction...",value:K,onChange:s=>se(s.target.value),rows:2})})]}),e.jsx(m,{children:e.jsxs(x,{className:"pt-6 space-y-3",children:[u==="pay_later"?e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs(n,{onClick:I,disabled:l.length===0||j.processing,size:"lg",className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),j.processing?"Saving...":"Save for Later"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Items will be handed over, payment collected later"})]}):u==="cash"?e.jsxs("div",{className:"text-center space-y-3",children:[e.jsxs(n,{onClick:$,disabled:l.length===0||h.processing,size:"lg",className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),h.processing?"Processing...":"Complete Sale"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Process payment and complete transaction"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(n,{onClick:I,disabled:l.length===0||j.processing,variant:"outline",size:"lg",className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),j.processing?"Saving...":"Save"]}),e.jsxs(n,{onClick:$,disabled:l.length===0||h.processing,size:"lg",className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),h.processing?"Processing...":"Complete"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs text-gray-500",children:[e.jsx("p",{className:"text-center",children:"Save for later processing"}),e.jsx("p",{className:"text-center",children:"Complete sale now"})]})]}),C?.success&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-600",children:C.success})}),C?.error&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:C.error})})]})})]})]})]})]})}export{Ve as default};
